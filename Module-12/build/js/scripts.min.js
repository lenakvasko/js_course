"use strict";var tryLocalStorage=function(e){if(e){return{isActive:"localStorage"in e,get:function(e){try{var t=localStorage.getItem(e);return null===t?void 0:JSON.parse(t)}catch(e){console.error("Get state error: ",e)}},set:function(e,t){try{var r=JSON.stringify(t);localStorage.setItem(e,r)}catch(e){console.error("Set state error: ",e)}}}}}(window),cards=[{url:"demo","logo-url":"https://www.freelogodesign.org/Content/img/logo-ex-7.png"}];tryLocalStorage.get("cardsData")&&(cards=tryLocalStorage.get("cardsData"));var inputValue,elements={form:document.querySelector(".js-form"),input:document.querySelector("input"),result:document.querySelector(".result-list"),source:document.querySelector("#template-container").innerHTML.trim()},template=Handlebars.compile(elements.source);function formSubmitClick(e){inputValue=elements.input.value,elements.input.value="",e.preventDefault(),addNewItem()}function addNewItem(){cards.some(function(e){return inputValue===e.url})?alert("Такая закладка уже есть"):/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(inputValue)?fetchGetImage(inputValue).then(function(e){cards.push({url:inputValue,"logo-url":e}),cardsViewer(),tryLocalStorage.set("cardsData",cards)}):alert("не верный формат")}function fetchGetImage(e){var t={key:"5cd40f3bec0e35c20a74cf61b9b1d52cacfe039b93914",q:e};return fetch("https://api.linkpreview.net/?key=".concat(t.key,"&q=").concat(t.q)).then(function(e){return e.json()}).then(function(e){return e.image}).catch(function(e){return console.error(e)})}function deleteResultClick(t){"BUTTON"===t.target.nodeName&&(cards=cards.filter(function(e){return t.target.parentNode.firstChild.innerHTML!=e.url}),cardsViewer(),tryLocalStorage.set("cardsData",cards))}function cardsViewer(){var e=cards.reduce(function(e,t){return e+template(t)},"");elements.result.innerHTML=e}cardsViewer(),elements.form.addEventListener("submit",formSubmitClick),elements.result.addEventListener("click",deleteResultClick);